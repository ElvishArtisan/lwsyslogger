## lwsyslogger.spec.in

@GENERATED_SCRIPT_FILE_WARNING@

##    Simple syslog server for Livewire environments
##    Copyright (C) 2024  Fred Gleason <fredg@paravelsystems.com>
##
##    This program is free software; you can redistribute it and/or modify
##    it under the terms of version 2 of the GNU General Public License as
##    published by the Free Software Foundation;
##
##    This program is distributed in the hope that it will be useful,
##    but WITHOUT ANY WARRANTY; without even the implied warranty of
##    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
##    GNU General Public License for more details.
##
##    You should have received a copy of the GNU General Public License
##    along with this program; if not, write to the Free Software
##    Foundation, Inc., 59 Temple Place, Suite 330, 
##    Boston, MA  02111-1307  USA
##

Summary: Simple syslog server for Livewire environments
Name: lwsyslogger
Version: @VERSION@
Release: @RPM_RELEASE@
License: GPL
Packager: Fred Gleason <fredg@paravelsystems.com>
Source: lwsyslogger-@VERSION@.tar.gz
BuildRequires: qt5-qtbase-devel qt5-linguist
BuildRoot: /var/tmp/lwsyslogger-@VERSION@

%package utils
Summary:  Tools for working with syslog systems


%description
 Lwsyslogger is a simple syslog server system. It is intended for use in
 Livewire AoIP environments.


%description utils
 This package contains send_syslog(1), a simple GUI applet that allows
 administrators to send test messages to a syslog system.


%prep


%setup


%build
%configure
make -j @CPUS_AVAIL@


%install
rm -rf $RPM_BUILD_ROOT
make install DESTDIR=$RPM_BUILD_ROOT


%post
/bin/systemctl daemon-reload
/usr/sbin/groupadd -r -f lwsyslogger
/usr/sbin/useradd -r -g lwsyslogger -s /bin/false -c "lwsyslogger system" lwsyslogger
if test ! -e /var/log/lwsyslogger ; then
    mkdir -p /var/log/lwsyslogger
    chown lwsyslogger:lwsyslogger /var/log/lwsyslogger
    chmod 770 /var/log/lwsyslogger
fi
if test ! -e /etc/lwsyslogger.conf ; then
    cp /usr/share/lwsyslogger/lwsyslogger-sample.conf /etc/lwsyslogger.conf
fi
/bin/systemctl restart lwsyslogger
/bin/systemctl enable lwsyslogger


%post utils
if [ -x %{_bindir}/gtk-update-icon-cache ] ; then
  %{_bindir}/gtk-update-icon-cache --quiet %{_datadir}/icons/hicolor || :
fi


%preun
/bin/systemctl stop lwsyslogger
/bin/systemctl disable lwsyslogger


%postun
/bin/systemctl daemon-reload


%postun utils
if [ -x %{_bindir}/gtk-update-icon-cache ] ; then
  %{_bindir}/gtk-update-icon-cache --quiet %{_datadir}/icons/hicolor || :
fi


%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root)
%{_sbindir}/lwsyslogger
%{_datadir}/lwsyslogger/lwsyslogger-sample.conf
%{_mandir}/man5/lwsyslogger.conf.5.gz
%{_mandir}/man8/lwsyslogger.8.gz
/usr/lib/systemd/system/lwsyslogger.service


%files utils
%{_bindir}/send_syslog
%{_datadir}/applications/lwsyslogger-send_syslog.desktop
%{_datadir}/icons/hicolor/16x16/apps/send_syslog.png
%{_datadir}/icons/hicolor/48x48/apps/send_syslog.png


%changelog
* @RPM_DATESTAMP@ Fred Gleason <fredg@paravelsystems.com> - @VERSION@-@RPM_RELEASE@
-- Autogenerated from build tree.
